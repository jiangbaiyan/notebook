baiyan

全部视频：https://segmentfault.com/a/1190000018488313

## 类的存储
 - 谈到PHP中的类，我们知道它是对象的抽象，也相当于对象的模板，它是编译阶段的产物。一个类被抽象出来，它本身有自己的属性，还有自己的方法。如果让我们自己去用C语言实现一个类的存储结构，我们如何设计？
 - 类的几大要素：类常量、普通属性、静态属性、动态属性、方法
 - 下面我们逐个来看究竟它们是被如何存储的
### 类常量的存储
 - 举一个类常量的例子：
```php
class A{
	const PI = 3.14;
}
```
  - 这里的PI就是一个类常量。常量名为PI，常量值为3.14。我们可以用两种方式来访问它：
  - 类外：A::PI
  - 类内：self::PI
  - 那么我们看一下常量的存储结构：
```c
struct _zend_class_entry {

	...
	HashTable constants_table;
	...
	
};
```
 - 在PHP7中，类是以一个zend_class_entry结构体来存储的。其中这个constants_table字段，就是用来存储类常量的。我们知道，常量是属于类作用域的，而不是对象作用域，所以它的值可以直接放在类结构体中。它是一个hashtable，key为常量名，value为常量值，这里还是很好理解的。
### 普通属性的存储
 - 普通属性属于对象作用域，每个对象的属性值可以不同。
 - 举一个普通属性的例子：
```php
class A{
	public $name = 'jby';
}
```
 - 这里name就是属性名，它有一个初始化值为jby。我们知道，由于普通属性是对象作用域，所以每一个对象下的属性值是不同的，所以不同对象的属性值要放在不同对象的结构中去存储。但是，由于PHP允许普通属性具有**初始化值**（如上例），而这个初始化值在所有对象中都是一样的，故初始化值可以放在类作用域中存储。下面看下普通属性是如何存储的：
```c
struct _zend_class_entry {

	...
	int default_properties_count; //普通属性的数量
	...
	zval *default_properties_table; //普通属性的初始化值
	...
	HashTable properties_info; //存储对象普通属性的信息
	... 
	
```
 - 我们首先看初始化值的存储，它属于类作用域，所以它可以直接存储在类结构体下的default_properties_table这个zval数组中
 - 然后我们看具体每个对象中属性的存储
